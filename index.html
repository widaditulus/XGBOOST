<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Prediksi 4D Adaptif</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container py-4">
        <div class="text-center mb-4">
            <h1 class="display-4 fw-bold text-primary"><i class="fas fa-chart-line me-2"></i>TW</h1>
            <p class="lead text-muted">XGBOOST AI</p>
        </div>
        
        <ul class="nav nav-tabs mb-3" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="control-tab" data-bs-toggle="tab" data-bs-target="#control-panel" type="button" role="tab">
                    <i class="fas fa-tachometer-alt me-2"></i>Panel Utama
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="evaluation-tab" data-bs-toggle="tab" data-bs-target="#evaluation-panel" type="button" role="tab">
                    <i class="fas fa-clipboard-check me-2"></i>Evaluasi & Laporan
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="health-tab" data-bs-toggle="tab" data-bs-target="#health-panel" type="button" role="tab">
                    <i class="fas fa-heartbeat me-2"></i>Kesehatan Model
                </button>
            </li>
        </ul>

        <div class="tab-content" id="mainTabContent">
            <div class="tab-pane fade show active" id="control-panel" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Panel Kontrol</h5>
                    </div>
                    <div class="card-body">
                        <div class="row align-items-end">
                            <div class="col-md-4">
                                <label for="pasaranSelect" class="form-label">Pilih Pasaran:</label>
                                <select id="pasaranSelect" class="form-select">
                                    {% for pasaran in pasaran_list %}
                                    <option value="{{ pasaran }}">{{ display_mapping[pasaran] }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="trainingMode" class="form-label">Mode Training:</label>
                                <select id="trainingMode" class="form-select">
                                    <option value="OPTIMIZED">Optimized</option>
                                    <option value="QUICK">Quick</option>
                                    <option value="COMPREHENSIVE">Comprehensive</option>
                                    <option value="DEEP_ANALYSIS">Deep Analysis</option>
                                    <option value="EXPERT_TUNING">Expert Tuning</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button id="updateDataBtn" class="btn btn-info w-100">
                                    <i class="fas fa-sync-alt me-2"></i>Update Data
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button id="startTrainingBtn" class="btn btn-warning w-100">
                                    <i class="fas fa-play me-2"></i>Mulai Training
                                </button>
                            </div>
                        </div>
                        <div class="form-check form-switch mt-3">
                            <input class="form-check-input" type="checkbox" id="recencyBiasCheck" checked>
                            <label class="form-check-label small" for="recencyBiasCheck">
                                Prioritaskan Pola Terbaru (Recency Bias)
                            </label>
                        </div>
                        <div id="dataInfo" class="mt-2 text-muted small"></div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-8">
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="fas fa-crystal-ball me-2"></i>Panel Prediksi</h5>
                            </div>
                            <div class="card-body">
                                <div class="row align-items-end">
                                    <div class="col-md-8">
                                        <label for="predictionDate" class="form-label">Tanggal Prediksi:</label>
                                        <input type="date" id="predictionDate" class="form-control">
                                    </div>
                                    <div class="col-md-4">
                                        <button id="predictBtn" class="btn btn-primary w-100">
                                            <i class="fas fa-search me-2"></i>Dapatkan Prediksi
                                        </button>
                                    </div>
                                </div>
                                <hr>
                                <div id="prediction-display" class="text-center" style="display: none;">
                                    <h3 class="text-muted">Hasil Prediksi untuk <span id="predDate" class="text-primary"></span></h3>
                                    <div class="prediction-result-box my-3">
                                        <span id="predictionResult">- - - -</span>
                                    </div>
                                    <div class="row">
                                        <div class="col-6 col-md-3 mb-2">
                                            <strong>AS:</strong> <span id="kandidatAs">-</span>
                                        </div>
                                        <div class="col-6 col-md-3 mb-2">
                                            <strong>KOP:</strong> <span id="kandidatKop">-</span>
                                        </div>
                                        <div class="col-6 col-md-3 mb-2">
                                            <strong>KEPALA:</strong> <span id="kandidatKepala">-</span>
                                        </div>
                                        <div class="col-6 col-md-3 mb-2">
                                            <strong>EKOR:</strong> <span id="kandidatEkor">-</span>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-6">
                                            <strong>Angka Main:</strong> <span id="angkaMain" class="text-danger">-</span>
                                        </div>
                                        <div class="col-6">
                                            <strong>Colok Bebas:</strong> <span id="colokBebas" class="text-success">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card mb-4">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Status Sistem</h5>
                            </div>
                            <div class="card-body">
                                <h6><i class="fas fa-brain me-2"></i>Status Model</h6>
                                <div id="modelStatus" class="mb-3">Memeriksa...</div>
                                
                                <h6><i class="fas fa-history me-2"></i>Aktivitas Sistem</h6>
                                <div id="systemActivityStatus">Siap.</div>
                                <div class="progress mt-2" style="display: none;">
                                    <div id="trainingProgressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="evaluation-panel" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-analytics me-2"></i>Evaluasi Performa Model</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-primary text-center">
                            Pasaran yang sedang dievaluasi: <strong id="activePasaranForEval" class="fs-5"></strong>
                        </div>
                        
                        <div class="row align-items-end bg-light p-3 rounded">
                            <div class="col-md-4">
                                <label for="evalStartDate" class="form-label">Tanggal Mulai:</label>
                                <input type="date" id="evalStartDate" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label for="evalEndDate" class="form-label">Tanggal Akhir:</label>
                                <input type="date" id="evalEndDate" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <button id="startEvaluationBtn" class="btn btn-info w-100">
                                    <i class="fas fa-play-circle me-2"></i>Mulai Evaluasi
                                </button>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div id="evaluationResultArea" class="mt-3" style="display: none;">
                            <h4 class="text-center">Ringkasan Hasil Evaluasi</h4>
                            <div id="evaluationStatus" class="text-center my-3"></div>
                            
                            <div class="row text-center justify-content-center evaluation-summary-cards" id="evaluationSummaryCards" style="display: none;">
                                <div class="col-md-2 col-6 mb-3">
                                    <div class="card bg-light">
                                        <div class="card-body p-2">
                                            <h6 class="card-title mb-1">Hari</h6>
                                            <h4 id="evalTotalDays" class="text-primary mb-0">0</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-2 col-6 mb-3">
                                    <div class="card bg-light">
                                        <div class="card-body p-2">
                                            <h6 class="card-title mb-1">AS Acc</h6>
                                            <h4 id="evalAsAccuracy" class="text-primary mb-0">0%</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-2 col-6 mb-3">
                                    <div class="card bg-light">
                                        <div class="card-body p-2">
                                            <h6 class="card-title mb-1">KOP Acc</h6>
                                            <h4 id="evalKopAccuracy" class="text-primary mb-0">0%</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-2 col-6 mb-3">
                                    <div class="card bg-light">
                                        <div class="card-body p-2">
                                            <h6 class="card-title mb-1">KEPALA Acc</h6>
                                            <h4 id="evalKepalaAccuracy" class="text-primary mb-0">0%</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-2 col-6 mb-3">
                                    <div class="card bg-light">
                                        <div class="card-body p-2">
                                            <h6 class="card-title mb-1">EKOR Acc</h6>
                                            <h4 id="evalEkorAccuracy" class="text-primary mb-0">0%</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-2 col-6 mb-3">
                                    <div class="card bg-light">
                                        <div class="card-body p-2">
                                            <h6 class="card-title mb-1">AM Acc</h6>
                                            <h4 id="evalAmAccuracy" class="text-primary mb-0">0%</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-2 col-6 mb-3">
                                    <div class="card bg-light">
                                        <div class="card-body p-2">
                                            <h6 class="card-title mb-1">CB Acc</h6>
                                            <h4 id="evalCbAccuracy" class="text-primary mb-0">0%</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="retrainingRecommendation" class="alert alert-warning mt-3" style="display: none;"></div>
                            
                            <div class="table-responsive mt-4">
                                <table class="table table-bordered table-striped text-center small">
                                    <thead class="table-dark">
                                        <tr>
                                            <th rowspan="2" class="align-middle">Tanggal</th>
                                            <th rowspan="2" class="align-middle">Aktual</th>
                                            <th colspan="4">Prediksi</th>
                                            <th colspan="2">Tambahan</th>
                                        </tr>
                                        <tr>
                                            <th>AS</th>
                                            <th>KOP</th>
                                            <th>KEPALA</th>
                                            <th>EKOR</th>
                                            <th>AM</th>
                                            <th>CB</th>
                                        </tr>
                                    </thead>
                                    <tbody id="evaluationDetailTableBody">
                                        </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="health-panel" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-heartbeat me-2"></i>Feature Importance</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-primary text-center">
                            Pasaran: <strong id="activePasaranForHealth" class="fs-5"></strong>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card">
                                    <div class="card-header bg-secondary text-white py-2">AS</div>
                                    <div class="card-body p-2" style="height: 300px;">
                                        <canvas id="asChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card">
                                    <div class="card-header bg-secondary text-white py-2">KOP</div>
                                    <div class="card-body p-2" style="height: 300px;">
                                        <canvas id="kopChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card">
                                    <div class="card-header bg-secondary text-white py-2">KEPALA</div>
                                    <div class="card-body p-2" style="height: 300px;">
                                        <canvas id="kepalaChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card">
                                    <div class="card-header bg-secondary text-white py-2">EKOR</div>
                                    <div class="card-body p-2" style="height: 300px;">
                                        <canvas id="ekorChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button id="refreshFeatureImportance" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-sync-alt me-1"></i>Refresh Feature Importance
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Drift Detection Log</h5>
                    </div>
                    <div class="card-body">
                        <div class="log-box" id="driftLog">
                            Memuat log drift detection...
                        </div>
                        <button id="refreshDriftLog" class="btn btn-outline-warning btn-sm mt-2">
                            <i class="fas fa-sync-alt me-1"></i>Refresh Log
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center mt-4 text-muted small">
            <p>&copy; 2025 Sistem Adaptif</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/script.js"></script>
</body>
</html>
